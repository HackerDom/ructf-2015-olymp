при первом обращении сайт выдает форму логина и реги на одной странице.
в регистрации юзер указывает свой логин, пароль, возраст.
Средний возраст посетителей нашего замечательного сайта:
SELECT COUNT(*) as total FROM users
после регистрации/логина на главной странице пишется
"Это уже ваша x попытка узнать пароль админа. В среднем вы тратите y секунд, разглядывая эту страницу."
Первый запрос идет такой:
SELECT COUNT(*) as total FROM visits WHERE `user`=$_SESSION["user"];
Второй такой:


Онлайн банк:
Есть регистрация и логин.
В регистрации 2 поля: логин, пароль.
После реги идет автоматический логин.
Регистрация и логин не уязвимы.
Доступны 4 функции:
Пополнить баланс, Снять деньги, Перевести сумму получателю, История транзакций (тут же указывается общий баланс).
Внутри есть 2 таблицы: users, transactions.
В users всего 3 колонки: id, login, password.
В transactions их 6: id, from, to, value, message, date.
Задача: увести пароль админа.
При регистрации пользователю автоматически зачисляется бонус 1337 рублей с примечанием "спасибо".
Поле пополнить баланс: текстовое поле, приводится к инту, может быть только положительным - не уязвимо. При пополнении создается транзакция: {id=id, from=payment, to=login, message='пополнение счета', date=date}
Снять деньги: текстовое поле, приводится к инту, может быть только положительным - не уязвимо. При снятии создается транзакция: {id=id, from=login, to=away, message='снятие денег', date=date}
Перевести сумму получателю: текстовое поле, приводится к инту, может быть только положительным - не уязвимо. Еще одно текстовое поле примечание. Создается транзакция: {id=id, from=loginfrom, to=loginto, message='message', date=date}. Внезапно message тоже фильтруется через mysql_real_escape.
История транзакций:
Баланс счета: SELECT SUM(value) as sum FROM `transactions` WHERE `to`=login OR `from`=login
Всего транзакций: SELECT COUNT(*) as total FROM `transactions` WHERE `to`=login OR `from`=login
Транзакции: SELECT * FROM `transactions` WHERE `to`=login OR `from`=login
Фильтр по примечанию: вот тут наконец бага, и исполняются следующие запросы.
SELECT COUNT(*) as total FROM `transactions` WHERE (`to`=login OR `from`=login) AND (`message` LIKE '%'.message.'%')
SELECT * FROM `transactions` WHERE (`to`=login OR `from`=login) AND (`message` LIKE '%'.message.'%')

Таким образом в message можно засунуть инъекцию.
Казалось бы, баланс на страницу выводится, да и сами транзакции тоже - поэтому это не слепая инъекция, ведь мы видим результат запроса. Но, из-за того, что запроса к БД 2, и каждый раз разное количество колонок, то union обречен на ошибку и ничего выводится не будет.


31337 investments:
Есть регистрация и логин.
В регистрации 2 поля: логин, пароль.
После реги идет автоматический логин.
Регистрация и логин без уязвимостей.
Доступны 4 функции:
Общий баланс, Пополнить баланс, Снять деньги, Доходность счета за период, История транзакций.
Внутри есть 2 таблицы: users, transactions.
В users 3 колонки: id, login, password.
В transactions их 6: id, user, value, percent, date.
Задача: увести пароль админа.
При регистрации пользователю автоматически зачисляется бонус 1337 рублей с примечанием "бонус".
Баланс: SELECT SUM(value) as sum FROM `transactions` WHERE `user`='asd'
Пополнить баланс: текстовое поле, приводится к инту, может быть только положительным - не уязвимо. Создается транзакция: {id=id, user=login, value=money, message='Пополнение счета', date=date}
Снять деньги: текстовое поле и кнопка, по нажатию на которую "извините, хуй".
История счета за период с x, по y:
ползунок(jquery) и кнопка "показать"
Доходность: SELECT SUM(value) as sum FROM `transactions` WHERE `user`='user' AND (`date` BEETWEEN x AND y)
Транзакции: SELECT * FROM `transactions` WHERE `user`='user' AND (`date` BEETWEEN x AND y)

Таким образом в диапозон дат можно засунуть инъекцию.
Казалось бы, доходноть на страницу выводится, да и сами транзакции тоже - поэтому это не слепая инъекция, ведь мы видим результат запроса. Но, из-за того, что запроса к БД 2, и в них разное количество колонок, то union injection обречен на ошибку, а раз ошибка, то ничего выводится не будет.
Каждый запрос на главную человеку зачисляется random()% прибыли. (всегда +)